asyncapi: 3.0.0
info:
  title: Regel - Rätt till VAH-försäkring (manuell)
  version: 1.0.0
  description: Manuell regel för att kontrollera om en person har rätt till Vård av husdjur.

channels:
  rtf.manuell.requests:
    address: rtf.manuell.requests
    messages:
      RtfManuellRequestMessage:
        $ref: "#/components/messages/RtfManuellRequestMessage"

  rtf.manuell.responses:
    address: rtf.manuell.responses
    messages:
      RtfManuellResponseMessage:
        $ref: "#/components/messages/RtfManuellResponseMessage"

operations:
  RtfManuellRequest:
    action: receive
    summary: Tillämpar regeln och kontrollerar om personen har rätt till Vård av husdjur.
    channel:
      $ref: "#/channels/rtf.manuell.requests"
    reply:
      address:
        description: Resultatet skickas tillbaka till källan.
        location: "$message.header#/replyTo"
      channel:
        $ref: "#/channels/rtf.manuell.responses"

components:
  schemas:
    RtfManuellRequestMessageHeaders:
      type: object
      properties:
        replyTo:
          type: string
          description: Topic där response ska skickas
        correlationId:
          type: string
          format: uuid
          description: Unikt ID som kopplar ihop request & response

    RtfManuellRequestMessageData:
      type: object
      title: RtfManuellRequestMessageData
      required:
        - kundbehovsflodeId
      properties:
        kundbehovsflodeId:
          type: string
          format: uuid
          description: Kundbehovsflöde id

    RtfManuellResponseMessageHeaders:
      type: object
      properties:
        correlationId:
          type: string
          format: uuid
          description: Unikt ID som kopplar ihop request & response

    RtfManuellResponseMessageData:
      type: object
      title: RtfManuellResponseMessageData
      required:
        - kundbehovsflodeId
        - rattTillForsakring
      properties:
        kundbehovsflodeId:
          type: string
          format: uuid
          description: Kundbehovsflöde id
        rattTillForsakring:
          title: rattTillForsakring
          type: string
          description: Utfall av regel, om personen har rätt till försäkring
          enum:
            - Ja
            - Nej

  messages:
    RtfManuellRequestMessage:
      headers:
        $ref: "#/components/schemas/RtfManuellRequestMessageHeaders"
      payload:
        title: RtfManuellRequestMessagePayload
        allOf:
          - $ref: "kogito-cloudevent.yaml#/components/schemas/KogitoCloudEvent"
          - type: object
            title: RtfManuellRequestMessageData
            required:
              - data
            properties:
              data:
                $ref: "#/components/schemas/RtfManuellRequestMessageData"

    RtfManuellResponseMessage:
      headers:
        $ref: "#/components/schemas/RtfManuellResponseMessageHeaders"
      payload:
        title: RtfManuellResponseMessagePayload
        allOf:
          - $ref: "kogito-cloudevent.yaml#/components/schemas/KogitoCloudEvent"
          - type: object
            title: RtfManuellResponseMessageData
            required:
              - data
            properties:
              data:
                $ref: "#/components/schemas/RtfManuellResponseMessageData"

